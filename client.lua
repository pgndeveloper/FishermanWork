-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Tunnel )-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module('vrp','lib/Tunnel')
local Proxy = module('vrp','lib/Proxy')
vRP = Proxy.getInterface('vRP')
scriptPescador = {}
Tunnel.bindInterface('gn_pescador',scriptPescador)
pescadorSV = Tunnel.getInterface('gn_pescador')
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Variáveis )----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local pescando
local contador = 0
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Pescar )-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
    while true do
        local cooldown = 1000
        if not pescando then
            local ped = PlayerPedId()
            if verificaPesca() then
                cooldown = 5
                if IsControlJustPressed(0,38) then
                    if pescadorSV.verificaItens() then
                        if pescadorSV.verificaRecompensa() then
                            contador = config['Pescaria']['TempoProgresso']
                            pescando = true
                            vRP.CarregarObjeto('amb@world_human_stand_fishing@idle_a','idle_c','prop_fishing_rod_01',49,60309)
                            vRP._playAnim(false,{{'amb@world_human_stand_fishing@idle_a','idle_c'}},true)
                            pescadorSV.recebeRecompensa()
                        end
                    end
                end
            end
        end
        Wait(cooldown)   
    end
end)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Contador )-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
    while true do
        Wait(1000)
        if contador > 0 then
            contador = contador - 1
            if contador == 0 then
                pescando = false
                vRP._stopAnim(false)
                vRP._DeletarObjeto()
                TriggerEvent('cancelando',false)
            end
        end
    end
end)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Cancelar F6 enquanto no processo )-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
    while true do
        local cooldown = 1000
        if pescando then
            cooldown = 5
            DisableControlAction(0,167,true)
        end
        Wait(cooldown)
    end
end)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--( Funções )------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function verificaPesca()
    local ped = PlayerPedId()
    local lastVehicle = GetPlayersLastVehicle()
    local lastVehicleHash = GetEntityModel(lastVehicle)
    local distance = GetDistanceBetweenCoords(GetEntityCoords(ped),GetEntityCoords(lastVehicle))
    for k,v in pairs(config['Pescaria']['Veículos']) do
        if v == lastVehicleHash and IsEntityInWater(lastVehicle) and distance <= 20 and not IsEntityInWater(ped) and not IsPedInAnyVehicle(ped,true) then
            return true
        end
    end
end
